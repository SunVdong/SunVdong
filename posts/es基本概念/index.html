<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<title class=pjax-title>Es 基本概念 - vdong.xyz</title><meta name=Description content><meta property="og:title" content="Es 基本概念">
<meta property="og:description" content="集群（cluster） 由一个名称标识（ elisticsearch.yml 中 cluster.name: &ldquo;docker-cluster&rdquo; ），由一个或多个节点（node）组成。 # 查看集群状态 GET _cluster/state 节点 （node） 默认情况下，群集中的每">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.vdong.xyz/posts/es%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-04T10:11:06+08:00">
<meta property="article:modified_time" content="2021-11-04T10:11:06+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Es 基本概念">
<meta name=twitter:description content="集群（cluster） 由一个名称标识（ elisticsearch.yml 中 cluster.name: &ldquo;docker-cluster&rdquo; ），由一个或多个节点（node）组成。 # 查看集群状态 GET _cluster/state 节点 （node） 默认情况下，群集中的每">
<meta name=application-name content="vdong.xyz">
<meta name=apple-mobile-web-app-title content="vdong.xyz">
<meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://www.vdong.xyz/posts/es%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/><link rel=prev href=https://www.vdong.xyz/posts/es%E5%AE%89%E8%A3%85/><link rel=next href=https://www.vdong.xyz/posts/es%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload="this.onload=null,this.rel='stylesheet'" href=/lib/fontawesome-free/all.min.css>
<noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload="this.onload=null,this.rel='stylesheet'" href=/lib/animate/animate.min.css>
<noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Es 基本概念","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.vdong.xyz\/posts\/es%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\/"},"genre":"posts","keywords":"es","wordcount":1290,"url":"https:\/\/www.vdong.xyz\/posts\/es%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\/","datePublished":"2021-11-04T10:11:06+08:00","dateModified":"2021-11-04T10:11:06+08:00","publisher":{"@type":"Organization","name":"vdong"},"author":{"@type":"Person","name":"vdong"},"description":""}</script></head>
<body header-desktop header-mobile><script type=text/javascript>function setTheme(a){document.body.setAttribute('theme',a)}function saveTheme(a){window.localStorage&&localStorage.setItem('theme',a)}function getMeta(b){const a=document.getElementsByTagName('meta');for(let c=0;c<a.length;c++)if(a[c].getAttribute('name')===b)return a[c];return''}if(window.localStorage&&localStorage.getItem('theme')){let a=localStorage.getItem('theme');a==='light'||a==='dark'||a==='black'?setTheme(a):window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?setTheme('dark'):setTheme('light')}else''==='light'||''==='dark'||''==='black'?(setTheme(''),saveTheme('')):(saveTheme('auto'),window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?setTheme('dark'):setTheme('light'));let metaColors={light:'#f8f8f8',dark:'#252627',black:'#000000'};getMeta('theme-color').content=metaColors[document.body.getAttribute('theme')]</script>
<div id=back-to-top></div>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title=vdong.xyz>vdong.xyz</a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/posts/> 文章 </a><a class=menu-item href=/tags/> 标签 </a><a class=menu-item href=/categories/> 分类 </a><span class="menu-item delimiter"></span><a href=# onclick=return!1 class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title=vdong.xyz>vdong.xyz</a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=# onclick=return!1 class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>目录</h2>
<div class=toc-content id=toc-content-auto></div>
</div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Es 基本概念</h1><div class=post-meta>
<div class=post-meta-line>
<span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>vdong</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/%E6%8A%80%E6%9C%AF/><i class="far fa-folder fa-fw"></i>技术</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-11-04>2021-11-04</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2021-11-04>2021-11-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1290 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 3 分钟&nbsp;</div>
</div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#集群cluster>集群（cluster）</a></li>
<li><a href=#节点-node>节点 （node）</a></li>
<li><a href=#索引index>索引（index）</a></li>
<li><a href=#分片-shard>分片 （shard）</a></li>
<li><a href=#文档-document>文档 （document）</a></li>
<li><a href=#相互关系>相互关系</a></li>
</ul>
</nav></div>
</div><div class=content id=content><h2 id=集群cluster>集群（cluster）</h2>
<p>由一个名称标识（ elisticsearch.yml 中 cluster.name: &ldquo;docker-cluster&rdquo; ），由一个或多个节点（node）组成。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=c1># 查看集群状态</span>
GET _cluster/state
</code></pre></div><h2 id=节点-node>节点 （node）</h2>
<p>默认情况下，群集中的每个节点都可以处理 HTTP 和 Transport 流量。 Transport 层专门用于节点之间的通信。 HTTP 层由 REST 客户端使用。</p>
<p>所有节点都知道集群中的所有其他节点，并且可以将客户端请求转发到适当的节点。</p>
<p>根据作用分类：</p>
<ol>
<li>master-eligible node：主节点，管理集群，去中心化，避免单点故障，自动选举</li>
<li>data node ： 数据节点，保存和操作数据，如CRUD、搜索和聚合</li>
<li>ingest node ：数据接入节点。 角色为 ingest。</li>
<li>remote-eligible node ：远程合格节点。角色为 remote_cluster_client ，可以充当远程客户端。</li>
<li>Machine learning node ： 机器学习节点。</li>
<li>transform node ：转换节点。</li>
</ol>
<blockquote>
<p>Coordnating node 协调节点</p>
<p>搜索请求或批量索引请求等请求可能涉及保存在不同数据节点上的数据。 例如，搜索请求在两个阶段中执行，这两个阶段由接收客户请求的节点（即协调节点）协调。</p>
<p>在分散阶段，协调节点将请求转发到保存数据的数据节点。 每个数据节点在本地执行该请求，并将其结果返回到协调节点。 在收集阶段，协调节点将每个数据节点的结果缩减为单个全局结果集。</p>
<p>每个节点都隐式地是一个协调节点。 这意味着通过 node.roles 具有明确的空角色列表的节点将仅充当协调节点，无法禁用。 结果，这样的节点需要具有足够的内存和 CPU 才能处理收集阶段。协调节点的定义为： node.roles: []</p>
</blockquote>
<p>角色：</p>
<ul>
<li>master</li>
<li>data</li>
<li>data_content</li>
<li>data_hot</li>
<li>data_warm</li>
<li>data_cold</li>
<li>data_frozen</li>
<li>ingest</li>
<li>ml</li>
<li>remote_cluster_client</li>
<li>transform</li>
</ul>
<h2 id=索引index>索引（index）</h2>
<p>对应关系型数据库里的 databse 概念（但不完全相同）。一个集群，可以有多个索引。是一个逻辑名称。</p>
<p>索引是文档（对应关系数据库的 record ）的集合。</p>
<h2 id=分片-shard>分片 （shard）</h2>
<p>分布式的搜索引擎，索引通常被拆分为多份，这份就叫分片（shard），分布在多个节点上。es 自动管理和平衡这些分片。</p>
<p>因此一个索引可以存储，超过单节点硬件限制的数据。</p>
<p>优点：</p>
<ol>
<li>方便水平拓展</li>
<li>多节点并行操作（潜在地），提高吞吐</li>
</ol>
<p>分片的类型：</p>
<ul>
<li>
<p>primary shard ：每个文档都有一个 primary shard 。 索引文档时，它首先在 Primary shard 上编制索引，然后在此分片的所有副本上（replica）编制索引。索引可以包含一个或多个主分片。 此数字确定索引相对于索引数据大小的可伸缩性。 创建索引后，无法更改索引中的主分片数。</p>
</li>
<li>
<p>replica shard：每个主分片可以具有零个或多个副本分片。数量可以动态修改（默认1个）。有两个目的：</p>
<p>1.增加故障转移：如果主要故障，可以将副本分片提升为主分片。即使你失去了一个 node，那么副本分片还是拥有所有的数据。</p>
<p>2.提高性能：get 和 search 请求可以由主 shard 或副本 shard 处理。</p>
</li>
</ul>
<p>主分片 和 副本分片 的区别：只有主分片可以接受索引请求。副本分片和主分片都可以提供查询请求。</p>
<p>shard 健康状态</p>
<ul>
<li>红色：集群中至少有一个主分片未分配</li>
<li>黄色：已分配所有主分片，但至少一个副分片未分配</li>
<li>绿色：分配所有分片</li>
</ul>
<h2 id=文档-document>文档 （document）</h2>
<p>es 索引或搜索的最小数据单元是文档，对应关系数据库的 record。</p>
<p>特点：</p>
<ol>
<li>独立</li>
<li>可以嵌套的</li>
<li>schemaless 不需要预先定义模式，可以动态调整</li>
</ol>
<p>文档通常是数据的 JSON 表示形式。JSON over HTTP 是与 Elasticsearch 进行通信的最广泛使用的方式。</p>
<h2 id=相互关系>相互关系</h2>
<p>每个 Index 由一个或许多的 documents 组成，并且这些 documents 可以分布于不同的 shard 之中，一个 node 里可以放零个或多个 shard （取决与 node 的种类），一个或多个节点（node）组成集群。</p>
<p>如：一个 index 有5个 shard 及1个 replica</p>
<p><img class=lazyload data-src="https://img-blog.csdnimg.cn/20190814211710327.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo,size_16,color_FFFFFF,t_70" data-srcset="https://img-blog.csdnimg.cn/20190814211710327.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo%2csize_16%2ccolor_FFFFFF%2ct_70, https://img-blog.csdnimg.cn/20190814211710327.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo%2csize_16%2ccolor_FFFFFF%2ct_70 1.5x, https://img-blog.csdnimg.cn/20190814211710327.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo%2csize_16%2ccolor_FFFFFF%2ct_70 2x" data-sizes=auto alt="https://img-blog.csdnimg.cn/20190814211710327.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo,size_16,color_FFFFFF,t_70" title=img></p>
<p>这些 shard 分布于不同的物理机器上</p>
<p><img class=lazyload data-src="https://img-blog.csdnimg.cn/20200624114427449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo,size_16,color_FFFFFF,t_70" data-srcset="https://img-blog.csdnimg.cn/20200624114427449.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo%2csize_16%2ccolor_FFFFFF%2ct_70, https://img-blog.csdnimg.cn/20200624114427449.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo%2csize_16%2ccolor_FFFFFF%2ct_70 1.5x, https://img-blog.csdnimg.cn/20200624114427449.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo%2csize_16%2ccolor_FFFFFF%2ct_70 2x" data-sizes=auto alt="https://img-blog.csdnimg.cn/20200624114427449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1VidW50dVRvdWNo,size_16,color_FFFFFF,t_70" title=img></p>
</div>
<div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>更新于 2021-11-04</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md></div>
<div class=post-info-share>
<span></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/es/>es</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span>
</section>
</div>
<div class=post-nav><a href=/posts/es%E5%AE%89%E8%A3%85/ class=prev rel=prev title="Es 安装"><i class="fas fa-angle-left fa-fw"></i>Es 安装</a>
<a href=/posts/es%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3/ class=next rel=next title="Es 索引相关">Es 索引相关<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.91.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreffer" title="DoIt 0.2.10"><i class="far fa-edit fa-fw"></i> DoIt</a>
</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer"></a></span></div>
</div></footer></div>
<div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部>
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论>
<i class="fas fa-comment fa-fw"></i>
</a>
</div><div class=assets><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/topbar/topbar.min.js></script><script type=text/javascript src=/lib/pjax/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js></script></div>
<div class=pjax-assets><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{}}</script></div>
</body>
</html>